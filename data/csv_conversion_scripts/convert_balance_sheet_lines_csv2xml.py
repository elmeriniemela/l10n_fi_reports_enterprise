import os
import re

import csv_converter

CSV_FILE = os.path.dirname(__file__) + '/../csv_sources/balance_sheet_lines.csv'
XML_FILE = os.path.dirname(__file__) + '/../balance_sheet_lines.xml'
XML_ID_PREFIX = 'sprintit_balance_'
MAIN_REPORT_ID = 'sprintit_balance_report'

DOMAIN_FORMATTING_STRING_ACCT_TYPE = "[('account_id.user_type_id', 'in', [%s])]"

acc_type_id2xml_id = {
    "1": "account.data_account_type_receivable",
    "2": "account.data_account_type_payable",
    "3": "account.data_account_type_liquidity",
    "4": "account.data_account_type_credit_card",
    "5": "account.data_account_type_current_assets",
    "6": "account.data_account_type_non_current_assets",
    "7": "account.data_account_type_prepayments",
    "8": "account.data_account_type_fixed_assets",
    "9": "account.data_account_type_current_liabilities",
    "10": "account.data_account_type_non_current_liabilities",
    "11": "account.data_account_type_equity",
    "12": "account.data_unaffected_earnings",
    "13": "account.data_account_type_other_income",
    "14": "account.data_account_type_revenue",
    "15": "account.data_account_type_depreciation",
    "16": "account.data_account_type_expenses",
    "17": "account.data_account_type_direct_costs",
    "18": "l10n_fi.account_tag_view",
    "19": "l10n_fi.account_tag_development_costs",
    "20": "l10n_fi.account_tag_immaterial_rights",
    "21": "l10n_fi.account_tag_goodwill",
    "22": "l10n_fi.account_tag_other_long_term_expenses",
    "23": "l10n_fi.account_tag_advance_payments_intangible",
    "24": "l10n_fi.account_tag_land_and_water_areas_owned",
    "25": "l10n_fi.account_tag_land_and_water_rights_lease",
    "26": "l10n_fi.account_tag_buildings_owned",
    "27": "l10n_fi.account_tag_building_leases",
    "28": "l10n_fi.account_tag_machines_and_hardware",
    "29": "l10n_fi.account_tag_other_tangible_assets",
    "30": "l10n_fi.account_tag_payments_on_account_tangible",
    "31": "l10n_fi.account_tag_shares_in_group_companies",
    "32": "l10n_fi.account_tag_receivables_from_associated_companies_investments",
    "33": "l10n_fi.account_tag_shares_in_associated_companies",
    "34": "l10n_fi.account_tag_other_shares_and_participations",
    "35": "l10n_fi.account_tag_other_receivables_investments",
    "36": "l10n_fi.account_tag_materials_and_supplies_inventories",
    "37": "l10n_fi.account_tag_work_in_progress",
    "38": "l10n_fi.account_tag_finished_goods_inventories",
    "39": "l10n_fi.account_tag_goods_in_transit",
    "40": "l10n_fi.account_tag_other_current_assets",
    "41": "l10n_fi.account_tag_advance_payments_for_property",
    "42": "l10n_fi.account_tag_trade_receivables_long-term",
    "43": "l10n_fi.account_tag_receivables_from_group_long-term",
    "44": "l10n_fi.account_tag_receivables_from_associated_companies_non-current",
    "45": "l10n_fi.account_tag_loan_receivables_long-term",
    "46": "l10n_fi.account_tag_deferred_tax_assets_are_long-term",
    "47": "l10n_fi.account_tag_other_long-term_receivables",
    "48": "l10n_fi.account_tag_unpaid_shares_of_long-term",
    "49": "l10n_fi.account_tag_prepaid_expenses_and_long-term",
    "50": "l10n_fi.account_tag_accounts_receivable",
    "51": "l10n_fi.account_tag_trade_group",
    "52": "l10n_fi.account_tag_receivables_from_group",
    "53": "l10n_fi.account_tag_accounts_receivable_from_associated_companies",
    "54": "l10n_fi.account_tag_receivables_from_associated_companies",
    "55": "l10n_fi.account_tag_loans",
    "56": "l10n_fi.account_tag_deferred_tax_assets",
    "57": "l10n_fi.account_tag_other_receivables",
    "58": "l10n_fi.account_tag_unpaid_contributions",
    "59": "l10n_fi.account_tag_prepayments_and_accrued_income",
    "60": "l10n_fi.account_tag_shares_in_the_consolidated_financial_securities",
    "61": "l10n_fi.account_tag_other_shares_and_marketable_securities",
    "62": "l10n_fi.account_tag_other_financial_assets",
    "63": "l10n_fi.account_tag_liquidity",
    "64": "l10n_fi.account_tag_stock_capital",
    "65": "l10n_fi.account_tag_share_premium_account",
    "66": "l10n_fi.account_tag_revaluation_reserve",
    "67": "l10n_fi.account_tag_the_invested_unrestricted_equity_fund",
    "68": "l10n_fi.account_tag_reserve",
    "69": "l10n_fi.account_tag_the_articles_of_association_or_fund_under_the_rules",
    "70": "l10n_fi.account_tag_the_fair_value_reserve",
    "71": "l10n_fi.account_tag_other_reserves",
    "72": "l10n_fi.account_tag_retained_earnings",
    "73": "l10n_fi.account_tag_profit_for_the_period",
    "74": "l10n_fi.account_tag_depreciation_difference",
    "75": "l10n_fi.account_tag_tax_based_reservations",
    "76": "l10n_fi.account_tag_provisions_for_pensions",
    "77": "l10n_fi.account_tag_tax_provisions",
    "78": "l10n_fi.account_tag_other_provisions",
    "79": "l10n_fi.account_tag_subordinated_loans_long-term",
    "80": "l10n_fi.account_tag_bonds_are_long-term",
    "81": "l10n_fi.account_tag_convertible_bonds_long-term",
    "82": "l10n_fi.account_tag_loans_from_financial_institutions_long-term",
    "83": "l10n_fi.account_tag_pension_loans_long-term",
    "84": "l10n_fi.account_tag_advances_received_long-term",
    "85": "l10n_fi.account_tag_accounts_payable-current",
    "86": "l10n_fi.account_tag_bills_of_long-term",
    "87": "l10n_fi.account_tag_consolidated_long-term_liabilities",
    "88": "l10n_fi.account_tag_payables_to_associated_companies_non-current",
    "89": "l10n_fi.account_tag_deferred_tax_liabilities_are_long-term",
    "90": "l10n_fi.account_tag_other_long-term_liabilities",
    "91": "l10n_fi.account_tag_accrued_long-term",
    "92": "l10n_fi.account_tag_capital_loans_are_short-term",
    "93": "l10n_fi.account_tag_bonds_short-term",
    "94": "l10n_fi.account_tag_convertible_bonds_short-term",
    "95": "l10n_fi.account_tag_loans_from_financial_institutions_short-term",
    "96": "l10n_fi.account_tag_pension_loans_short-term",
    "97": "l10n_fi.account_tag_advances_received_short-term",
    "98": "l10n_fi.account_tag_accounts_payable",
    "99": "l10n_fi.account_tag_bills_of_short-term",
    "100": "l10n_fi.account_tag_trade_payables_to_group",
    "101": "l10n_fi.account_tag_group_short-term_liabilities",
    "102": "l10n_fi.account_tag_trade_payables_to_associated_companies",
    "103": "l10n_fi.account_tag_payables_to_associated_companies",
    "104": "l10n_fi.account_tag_deferred_tax_liabilities_are_short-term",
    "105": "l10n_fi.account_tag_other_short-term_liabilities",
    "106": "l10n_fi.account_tag_accrued_liabilities_short-term",
    "107": "l10n_fi.account_tag_sales",
    "108": "l10n_fi.account_tag_sales_adjustment_items",
    "109": "l10n_fi.account_tag_manufacturing_warehouse_change",
    "110": "l10n_fi.account_tag_manufacturing_own_use",
    "111": "l10n_fi.account_tag_income_other",
    "112": "l10n_fi.account_tag_purchases",
    "113": "l10n_fi.account_tag_purchases_adjustment_items",
    "114": "l10n_fi.account_tag_change_in_inventories",
    "115": "l10n_fi.account_tag_external_services",
    "116": "l10n_fi.account_tag_wages_and_salaries_in_production",
    "117": "l10n_fi.account_tag_wages_and_salaries_other",
    "118": "l10n_fi.account_tag_pension_costs_of_production",
    "119": "l10n_fi.account_tag_pension_costs_other",
    "120": "l10n_fi.account_tag_other_additional_expenses_production",
    "121": "l10n_fi.account_tag_other_additional_expenses_other",
    "122": "l10n_fi.account_tag_depreciation_according_to_plan",
    "123": "l10n_fi.account_tag_impairment_of_fixed_assets",
    "124": "l10n_fi.account_tag_impairment_losses_financial_assets_current_assets",
    "125": "l10n_fi.account_tag_personnel_other",
    "126": "l10n_fi.account_tag_premises_costs",
    "127": "l10n_fi.account_tag_vehicle_expenses",
    "128": "l10n_fi.account_tag_it_expenses",
    "129": "l10n_fi.account_tag_in_machinery_and_equipment_expenses",
    "130": "l10n_fi.account_tag_travelling",
    "131": "l10n_fi.account_tag_representation",
    "132": "l10n_fi.account_tag_selling_expenses",
    "133": "l10n_fi.account_tag_marketing_expenses",
    "134": "l10n_fi.account_tag_research_and_development",
    "135": "l10n_fi.account_tag_administrative_services",
    "136": "l10n_fi.account_tag_other_administrative_expenses",
    "137": "l10n_fi.account_tag_other_fixed_costs",
    "138": "l10n_fi.account_tag_income_from_shares_in_group",
    "139": "l10n_fi.account_tag_income_from_associated_company",
    "140": "l10n_fi.account_tag_investment_income_other_current_assets_group",
    "141": "l10n_fi.account_tag_other_investment_income_from_fixed_assets",
    "142": "l10n_fi.account_tag_interest_and_financial_income_from_group",
    "143": "l10n_fi.account_tag_other_interest_and_financial_income",
    "144": "l10n_fi.account_tag_impairment_losses_on_investments_in_fixed_assets",
    "145": "l10n_fi.account_tag_financial_expenses_group",
    "146": "l10n_fi.account_tag_other_financial_expenses",
    "147": "l10n_fi.account_tag_change_in_depreciation_difference",
    "148": "l10n_fi.account_tag_change_in_provisions",
    "149": "l10n_fi.account_tag_group_contribution",
    "150": "l10n_fi.account_tag_taxes_for_the_period",
    "151": "l10n_fi.account_tag_deferred_taxes",
    "152": "l10n_fi.account_tag_other_tax"
}

class CsvBalanceSheetConverter(csv_converter.CsvConverter):

    def convert_domain(self, domain):
        account_tag_ids = re.split(r'\D+', domain)[1:-1]
        account_tag_xml_ids = []

        for id in account_tag_ids:
            xml_id = acc_type_id2xml_id.get(id)
            account_tag_xml_ids.append("ref('" + xml_id + "')")
        domain_formatting_string_parameter = ','.join(account_tag_xml_ids)
        return DOMAIN_FORMATTING_STRING_ACCT_TYPE % domain_formatting_string_parameter


if __name__ == '__main__':
    # service.py executed as script
    # do something
    csv_balance_sheet_converter = CsvBalanceSheetConverter()
    csv_balance_sheet_converter.convert_csv2xml(csv_file = CSV_FILE, xml_file = XML_FILE,
                                                main_report_id = MAIN_REPORT_ID,
                                                xml_id_prefix = XML_ID_PREFIX)